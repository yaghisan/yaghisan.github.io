<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="../assets/portfolio.css">
  <script src="../submenu.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-tomorrow.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-dart.min.js"></script>

  <title>ä¸»è¦æ©Ÿèƒ½</title>
</head>
<body>
  <header class="progress-bar">
    <h3>portfolio/feature</h3>
    <div class="center-container">
      <div class="beige-background">
        <div class="upper-nav">
          <a href="../index.html">Home</a>
          <div class="portfolio-dropdown">
            <a href="#" id="portfolio-link" onclick="togglePortfolioFixed(event)">Portfolio</a>
            <div id="portfolio-submenu" class="portfolio-submenu">
              <a href="tech.html">æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯</a>
              <a href="architecture.html">ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹é€ </a>
              <a href="feature.html">ä¸»è¦æ©Ÿèƒ½</a>
              <a href="overview.html">ä»Šå¾Œã®å±•æœ›</a>
            </div>
          </div>
          <a href="profile.html">Profile</a>
        </div>
      </div>
    </div>
  </header>
  <div class="abstract">
    <h3>ğŸ</h3>
    <h1>ä¸»è¦æ©Ÿèƒ½</h1>
    <h2>ä¸»è¦æ©Ÿèƒ½ã¾ã¨ã‚ (2025/6 ç¾åœ¨)</h2>
  </div>
  <div class="container">
    <main>
      <h2>ä¸»è¦æ©Ÿèƒ½</h2>
      <h3>A. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²/ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½</h3>
      <p>unreal.appã§ã¯ã€Supabase Authã¨Firebase Authã‚’çµ„ã¿åˆã‚ã›ãŸã‚»ã‚­ãƒ¥ã‚¢ãªèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚</p>
      <div class="row-images">
        <img src="../assets/images/signup.png" alt="ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ç”»é¢" class="mobile-image">
        <img src="../assets/images/login.png" alt="ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢" class="mobile-image">
      </div>
      <div class="center-container">
        <button class="toggle-btn" onclick="toggleDetails()">â–¼ è©³ç´°ã‚’è¡¨ç¤º</button>
      </div>
      <div id="details" class="collapsed">
        <div class="grey-background">
          <h4>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ãƒ­ãƒ¼</h4>
          <div class="center-container">
          <pre><code class="language-dart">
  /// ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²å‡¦ç†
  Future<void> signUp({
    required String email,
    required String password,
    String? username,
  }) async {
    try {
      state = state.copyWith(isLoading: true, error: null);

      final AuthResponse response = await _client.auth.signUp(
        email: email,
        password: password,
        data: <String, dynamic>{
          if (username != null) 'name': username,
          'username': username ?? 'ãƒ¦ãƒ¼ã‚¶ãƒ¼',
        },
      );

      if (response.user != null) {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’usersãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜
        await _client.from('users').insert(<String, dynamic>{
          'id': response.user!.id,
          'email': email,
          'name': username ?? 'ãƒ¦ãƒ¼ã‚¶ãƒ¼',
          'created_at': DateTime.now().toIso8601String(),
        });

        state = state.copyWith(user: response.user, isLoading: false);
      }
    } catch (e) {
      state = state.copyWith(
        isLoading: false,
        error: _translateError(e.toString()),
      );
    }
  }
          </code></pre>
        </div>
      <h4>ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼</h4>
      <div class="center-container">
        <pre><code class="language-dart">
  /// ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
  Future<void> signIn({required String email, required String password}) async {
    try {
      state = state.copyWith(isLoading: true, error: null);

      final AuthResponse response = await _client.auth.signInWithPassword(
        email: email,
        password: password,
      );

      if (response.user != null) {
        state = state.copyWith(user: response.user, isLoading: false);
        // ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸæ™‚ã¯ãƒ­ãƒ“ãƒ¼ã«è‡ªå‹•é·ç§»
      }
    } catch (e) {
      state = state.copyWith(
        isLoading: false,
        error: _translateError(e.toString()),
      );
    }
  }
        </code></pre>
      </div>
        </div>
      </div>
      <p>èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã®èªè¨¼çŠ¶æ…‹ç›£è¦–ã€æ—¥æœ¬èªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å¯¾å¿œã€ãƒ¡ãƒ¼ãƒ«ç¢ºèªãƒªãƒ³ã‚¯ã®å†é€ä¿¡æ©Ÿèƒ½ã‚’æä¾›ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã‚’é‡è¦–ã—ãŸè¨­è¨ˆã«ãªã£ã¦ã„ã¾ã™ã€‚</p><hr>
      <h3>B. ãƒ¯ãƒ³ãƒŠã‚¤ãƒˆäººç‹¼ã«ã¤ã„ã¦</h3>
      <p>ãƒ¯ãƒ³ãƒŠã‚¤ãƒˆäººç‹¼ã¯ã€æœ¬ã‚¢ãƒ—ãƒªã®ãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½ã¨ã—ã¦å®Ÿè£…ã•ã‚ŒãŸãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚²ãƒ¼ãƒ ã§ã™ã€‚</p>
      <h4>1.0 ã‚²ãƒ¼ãƒ ä½œæˆ</h4>
      <p>ã‚²ãƒ¼ãƒ ä½œæˆã§ã¯ã€æ±ç”¨çš„ãªGameRoomã¨ãƒ¯ãƒ³ãƒŠã‚¤ãƒˆäººç‹¼å°‚ç”¨ã®WerewolfRoomã‚’åŒæ™‚ã«ä½œæˆã—ã€çµ±åˆçš„ã«ç®¡ç†ã—ã¾ã™ã€‚</p>
      <div class="row-images">
        <img src="../assets/images/chosa.png" alt="ã‚²ãƒ¼ãƒ ä½œæˆç”»é¢" class="mobile-image">
        <img src="../assets/images/ONwolf/join.png" alt="ã‚²ãƒ¼ãƒ ä½œæˆç”»é¢" class="mobile-image">
      </div>
      <div class="grey-background">
        <h5>è£å´ã®å‡¦ç†</h5>
        <div class="center-container">
          <pre><code class="language-dart">
    // 1. æ±ç”¨ã®GameRoomã‚’ä½œæˆï¼ˆãƒ«ãƒ¼ãƒ å‚åŠ ã§æ¤œç´¢ã§ãã‚‹ã‚ˆã†ã«ï¼‰
    final GameRoom gameRoom = await roomService.createRoom(
      name: roomName,
      gameType: 'werewolf',
      hostId: currentUser.id,
      description: 'ãƒ¯ãƒ³ãƒŠã‚¤ãƒˆäººç‹¼ã®ãƒ«ãƒ¼ãƒ ',
      isPrivate: false,
    );

    // 2. ãƒ¯ãƒ³ãƒŠã‚¤ãƒˆäººç‹¼å°‚ç”¨ã®ãƒ«ãƒ¼ãƒ ã‚’ä½œæˆï¼ˆã‚²ãƒ¼ãƒ é€²è¡Œç”¨ï¼‰
    final WerewolfRoom werewolfRoom = await gameService.createRoom(
      hostId: currentUser.id,
      hostName: userName,
      roomName: roomName,
      roomId: gameRoom.id, // åŒã˜IDã‚’ä½¿ç”¨ã—ã¦çµ±åˆ
    );
          </code></pre>
        </div>
      </div>
      <p>ã“ã®äºŒé‡æ§‹é€ ã«ã‚ˆã‚Šã€ãƒ«ãƒ¼ãƒ æ¤œç´¢æ©Ÿèƒ½ã¨ã‚²ãƒ¼ãƒ é€²è¡Œãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†é›¢ã—ã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã‚’ç¢ºä¿ã—ã¦ã„ã¾ã™ã€‚ä½œæˆã•ã‚ŒãŸãƒ«ãƒ¼ãƒ ã«ã¯6æ¡ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ«ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã€ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå‚åŠ ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>
      <h4>1.1 ã‚²ãƒ¼ãƒ å‚åŠ </h4>
      <p>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯6æ¡ã®ãƒ«ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ã“ã¨ã§ã€æ—¢å­˜ã®ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ ã«å‚åŠ ã§ãã¾ã™ã€‚</p>
      <h5>è£å´ã®å‡¦ç†</h5>
      <div class="center-container">
        <pre><code class="language-dart">
    // ãƒ«ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ã§ãƒ«ãƒ¼ãƒ ã«å‚åŠ 
    final GameRoom? room = await roomService.joinRoomByCode(
      roomCode: codeController.text,
      playerId: currentUser.id,
    );

    // ãƒ¯ãƒ³ãƒŠã‚¤ãƒˆäººç‹¼ã®å ´åˆã¯ã€WerewolfRoomã«ã‚‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ 
    if (gameType == 'werewolf') {
      final werewolfRoom = await werewolfRepository.getRoom(room.id);
      if (werewolfRoom != null) {
        await werewolfService.addPlayer(
          werewolfRoom,
          id: currentUser.id,
          name: userName,
          isBot: false,
        );
      }
    }
        </code></pre>
      </div>
      <p>å‚åŠ å‡¦ç†ã§ã¯ã€ã¾ãšGameRoomãƒ¬ãƒ™ãƒ«ã§ã®å‚åŠ ç¢ºèªã‚’è¡Œã„ã€ãã®å¾Œãƒ¯ãƒ³ãƒŠã‚¤ãƒˆäººç‹¼å°‚ç”¨ã®WerewolfRoomã«ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã‚’åŒæœŸã—ã¾ã™ã€‚ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã«ã‚ˆã‚Šã€ç‰‡æ–¹ã®å‡¦ç†ãŒå¤±æ•—ã—ãŸã¨ã—ã¦ã‚‚ã€ã‚‚ã†ç‰‡æ–¹ã¯ç¶™ç¶šã•ã‚Œã¾ã™ã€‚</p>
      <h4>2.0 ã‚²ãƒ¼ãƒ é–‹å§‹</h4>
      <p>ãƒ›ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€å½¹è·é…å¸ƒã¨å¤œãƒ•ã‚§ãƒ¼ã‚ºã¸ã®ç§»è¡ŒãŒè‡ªå‹•ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</p>
      <h5>è£å´ã®å‡¦ç†</h5>
      <div class="center-container">
        <pre><code class="language-dart">
    Future<WerewolfRoom> startGame(WerewolfRoom room) async {
      if (room.players.length < 3) {
        throw Exception('ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã™ã‚‹ã«ã¯æœ€ä½3äººã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå¿…è¦ã§ã™');
      }

      // å½¹è·ã®è¨­å®š
      final WerewolfRoom setupRoom = _setupRoles(room);

      // å¤œãƒ•ã‚§ãƒ¼ã‚ºã«ç§»è¡Œ
      final WerewolfRoom nightRoom = setupRoom.copyWith(
        phase: GamePhase.night,
        gameStartTime: DateTime.now(),
      );

      // ãƒœãƒƒãƒˆã®å¤œã®è¡Œå‹•ã‚’å‡¦ç†
      final WerewolfRoom withBotActions = _botActions.processBotNightActions(nightRoom);

      await _repository.saveRoom(withBotActions);
      return withBotActions;
    }
        </code></pre>
      </div>
      <p>ã‚²ãƒ¼ãƒ é–‹å§‹æ™‚ã«ã€åŸºæœ¬å½¹è·ï¼ˆæ‘äººÃ—2ã€äººç‹¼Ã—2ã€å ã„å¸«Ã—1ã€æ€ªç›—Ã—1ï¼‰ãŒãƒ©ãƒ³ãƒ€ãƒ ã«é…å¸ƒã•ã‚Œã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°åˆ†ã®å½¹è·ã¨ä¸­å¤®ã‚«ãƒ¼ãƒ‰ç”¨ã®å½¹è·ãŒæ±ºå®šã•ã‚Œã¾ã™ã€‚åŒæ™‚ã«ãƒœãƒƒãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¤œã®è¡Œå‹•ã‚‚è‡ªå‹•å‡¦ç†ã•ã‚Œã¾ã™ã€‚</p>
      <h4>3.0 å¤œã®ã‚¿ãƒ¼ãƒ³</h4>
      <p>å¤œãƒ•ã‚§ãƒ¼ã‚ºã§ã¯ã€å„å½¹è·ãŒç§˜å¯†è£ã«è¡Œå‹•ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚å ã„å¸«ã¯ä»–ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¾ãŸã¯å¢“åœ°ã®ã‚«ãƒ¼ãƒ‰ã‚’å ã„ã€æ€ªç›—ã¯ä»–ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨å½¹è·äº¤æ›ã‚’è¡Œã„ã¾ã™ã€‚</p>
      <div class="row-images">
        <img src="../assets/images/ONwolf/night1.png" alt="å¤œãƒ•ã‚§ãƒ¼ã‚ºã§ã®å½¹è·è¡Œå‹•ç”»é¢" class="mobile-image">
        <img src="../assets/images/ONwolf/night2.png" alt="å¤œãƒ•ã‚§ãƒ¼ã‚ºã§ã®å½¹è·è¡Œå‹•ç”»é¢" class="mobile-image">
      </div>
      <h5>è£å´ã®å‡¦ç†</h5>
      <div class="center-container">
        <pre><code class="language-dart">
    // å¤œãƒ•ã‚§ã‚¤ã‚ºã®çµ‚äº†ç¢ºèª
    bool isNightPhaseComplete(WerewolfRoom room) {
      final List<WerewolfRole> actionRequiredRoles = [
        WerewolfRole.seer,
        WerewolfRole.thief,
        WerewolfRole.werewolf,
      ];

      final List<WerewolfPlayer> actionRequiredPlayers =
          room.players.where((player) {
            final role = room.currentRoles[player.id];
            return role != null && actionRequiredRoles.contains(role);
          }).toList();

      // å…¨ã¦ã®è¡Œå‹•å¿…è¦ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¡Œå‹•æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
      return actionRequiredPlayers.every(
        (player) => room.nightActions.containsKey(player.id),
      );
    }
        </code></pre>
      </div>
      <p>å¤œã®è¡Œå‹•ã¯ nightActionsãƒãƒƒãƒ—ã§ç®¡ç†ã•ã‚Œã€è¡Œå‹•ãŒå¿…è¦ãªå…¨å½¹è·ï¼ˆå ã„å¸«ã€æ€ªç›—ã€äººç‹¼ï¼‰ã®è¡Œå‹•å®Œäº†ã‚’ç›£è¦–ã—ã¦ã„ã¾ã™ã€‚ãƒœãƒƒãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯è‡ªå‹•çš„ã«ãƒ©ãƒ³ãƒ€ãƒ ãªè¡Œå‹•ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã€ã™ã¹ã¦ã®äººé–“ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¡Œå‹•çµ‚äº†ãŒå®Ÿè³ªçš„ãªãƒ•ãƒ©ã‚°ã«ãªã£ã¦ã„ã¾ã™ã€‚</p>
      <h4>4.0 æ˜¼ã®ã‚¿ãƒ¼ãƒ³</h4>
      <p>æ˜¼ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆè­°è«–æ™‚é–“ï¼‰ã¯5åˆ†é–“ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€æ™‚é–“å†…ã«ã™ã¹ã¦ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæŠ•ç¥¨ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã“ã¨ã§å³åº§ã«æŠ•ç¥¨ãƒ•ã‚§ãƒ¼ã‚ºã¨ç§»ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
      <h4>4.1 æŠ•ç¥¨ã®ã‚¿ãƒ¼ãƒ³</h4>
      <p>è­°è«–æ™‚é–“çµ‚äº†å¾Œã€å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯å‡¦åˆ‘ã—ãŸã„ç›¸æ‰‹ã«æŠ•ç¥¨ã—ã¾ã™ã€‚è‡ªåˆ†è‡ªèº«ã«ã¯æŠ•ç¥¨ã§ãã¾ã›ã‚“ã€‚</p>
      <h4>4.2 çµæœç™ºè¡¨</h4>
      <p>å…¨å“¡ã®æŠ•ç¥¨å®Œäº†å¾Œã€å‹åˆ©é™£å–¶ã®åˆ¤å®šã¨ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—ãŒè‡ªå‹•å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚</p>
      <div class="row-images">
        <img src="../assets/images/ONwolf/vote.png" alt="æŠ•ç¥¨ç”»é¢" class="mobile-image">
        <img src="../assets/images/ONwolf/select.png" alt="çµæœç™ºè¡¨ç”»é¢" class="mobile-image">
      </div>
      <h5>è£å´ã®å‡¦ç†</h5>
      <div class="center-container">
        <pre><code class="language-dart">
    WerewolfRoom calculateGameResult(WerewolfRoom room) {
      // æŠ•ç¥¨ã®é›†è¨ˆ
      final Map<String, int> voteCounts = {};
      for (final vote in room.votes.values) {
        voteCounts[vote] = (voteCounts[vote] ?? 0) + 1;
      }

      // æœ€å¤šå¾—ç¥¨è€…ã‚’ç‰¹å®š
      String? executedPlayerId;
      int maxVotes = 0;
      voteCounts.forEach((playerId, count) {
        if (count > maxVotes) {
          maxVotes = count;
          executedPlayerId = playerId;
        }
      });

      // å‹åˆ©é™£å–¶ã®åˆ¤å®š
      String winningSide = 'æ‘äººé™£å–¶';
      if (executedPlayerRole == WerewolfRole.werewolf) {
        winningSide = 'æ‘äººé™£å–¶';
      } else if (executedPlayerRole == WerewolfRole.tanner) {
        winningSide = 'åŠã‚Šäºº';
      } else {
        winningSide = hasWerewolf ? 'äººç‹¼é™£å–¶' : 'æ‘äººé™£å–¶';
      }

      // ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—ã¨çµæœãƒ•ã‚§ãƒ¼ã‚ºã«ç§»è¡Œ
      final gamePoints = _calculatePoints(room, executedPlayerId, winningSide);
      return room.copyWith(
        phase: GamePhase.result,
        winningSide: winningSide,
        currentGamePoints: gamePoints,
      );
    }
        </code></pre>
      </div>
      <p>æŠ•ç¥¨é›†è¨ˆã§ã¯æœ€å¤šå¾—ç¥¨è€…ãŒå‡¦åˆ‘ã•ã‚Œã€ãã®å½¹è·ã«å¿œã˜ã¦å‹åˆ©é™£å–¶ãŒæ±ºå®šã•ã‚Œã¾ã™ã€‚ã¾ãŸã€ç‹¬è‡ªã®ãƒã‚¤ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚Šå‹åˆ©ãƒãƒ¼ãƒ ã«2ptã€åŠ ãˆã¦å½¹è·å›ºæœ‰ã®ãƒœãƒ¼ãƒŠã‚¹ãƒã‚¤ãƒ³ãƒˆãŒä»˜ä¸ã•ã‚Œã¾ã™ã€‚</p>
      <h4>5.0 ã‚²ãƒ¼ãƒ å†é–‹orä¸­æ–­</h4>
      <p>çµæœç™ºè¡¨å¾Œã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã€Œèª¿æŸ»ç¶™ç¶šã€ï¼ˆæ¬¡ã‚²ãƒ¼ãƒ é–‹å§‹ï¼‰ã¾ãŸã¯ã€Œèª¿æŸ»ä¸­æ–­ã€ï¼ˆæœ€çµ‚çµæœã¸ï¼‰ã‚’é¸æŠã§ãã¾ã™ã€‚</p>
      <h4>5.1 æœ€çµ‚çµæœç”»é¢</h4>
      <p>èª¿æŸ»ä¸­æ–­ã¾ãŸã¯èª°ã‹ãŒç›®æ¨™ãƒã‚¤ãƒ³ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ20ptï¼‰ã«åˆ°é”ã—ãŸå ´åˆã€æœ€çµ‚çµæœç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
      <div class="center-container">
        <img src="../assets/images/ONwolf/final_result.png" alt="æœ€çµ‚çµæœ" class="fixed-image">
      </div>
      <h5>è£å´ã®å‡¦ç†</h5>
      <div class="center-container">
        <pre><code class="language-dart">
    WerewolfRoom calculateFinalResults(WerewolfRoom room) {
      // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒã‚¤ãƒ³ãƒˆã‚’æ›´æ–°
      final updatedPlayers = room.players.map((player) {
        final gamePoints = room.currentGamePoints[player.id] ?? 0;

        // ãƒã‚¤ãƒ³ãƒˆå±¥æ­´ã‚’æ›´æ–°
        final updatedHistory = Map<String, double>.from(player.pointsHistory);
        final gameKey = 'game_${DateTime.now().millisecondsSinceEpoch}';
        updatedHistory[gameKey] = gamePoints;

        // åˆè¨ˆãƒã‚¤ãƒ³ãƒˆã‚’æ›´æ–°
        final newTotalPoints = player.points + gamePoints;

        return player.copyWith(
          points: newTotalPoints,
          pointsHistory: updatedHistory,
        );
      }).toList();

      // æœ€çµ‚çµæœè¡¨ç¤ºãƒ•ã‚§ãƒ¼ã‚ºã«ç§»è¡Œ
      return room.copyWith(
        phase: GamePhase.final_result,
        players: updatedPlayers,
      );
    }
        </code></pre>
      </div>
      <p>æœ€çµ‚çµæœã§ã¯ã€å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®é †ä½ã¨ç´¯è¨ˆç²å¾—ãƒã‚¤ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã®ç”»é¢ã‹ã‚‰ã€Œãƒ­ãƒ“ãƒ¼ã«æˆ»ã‚‹ã€ã‚’é¸æŠã™ã‚‹ã“ã¨ã§ã€ç¾åœ¨ã®ãƒ«ãƒ¼ãƒ æƒ…å ±ã‚’ä¿æŒã—ãŸã¾ã¾æ¬¡ã®ã‚²ãƒ¼ãƒ ã‚’ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«é–‹å§‹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
    </main>
    <aside>
      <nav>
        <strong>ç›®æ¬¡</strong>
        <ul>
          <li><a href="#section1">ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½</a></li>
          <li><a href="#section2">ãƒ¯ãƒ³ãƒŠã‚¤ãƒˆäººç‹¼</a></li>
        </ul>
      </nav>
    </aside>
  </div>
</body>
</html>